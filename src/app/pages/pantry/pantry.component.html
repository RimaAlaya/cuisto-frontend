<div class="pantry-page">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-text">
          <h1>ü•ï My Pantry</h1>
          <p>Manage your ingredients and discover recipes you can make right now</p>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn btn-secondary" (click)="searchRecipes()" [disabled]="totalItems === 0">
          <span>üîç</span>
          <span>Find Recipes</span>
        </button>
        <button class="btn btn-primary" (click)="toggleAddForm()">
          <span>{{ showAddForm ? '‚úï' : '+' }}</span>
          <span>{{ showAddForm ? 'Cancel' : 'Add Ingredient' }}</span>
        </button>
      </div>
    </div>

    <!-- Stats -->
    <div class="pantry-stats">
      <div class="stat-card">
        <div class="stat-icon">üì¶</div>
        <div class="stat-content">
          <div class="stat-value">{{ totalItems }}</div>
          <div class="stat-label">Ingredients</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üè∑Ô∏è</div>
        <div class="stat-content">
          <div class="stat-value">{{ categoriesWithItems.length }}</div>
          <div class="stat-label">Categories</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üçΩÔ∏è</div>
        <div class="stat-content">
          <div class="stat-value">{{ suggestedRecipes.length }}</div>
          <div class="stat-label">Possible Recipes</div>
        </div>
      </div>
    </div>

    <!-- Add Item Modal -->
    @if (showAddForm) {
      <div class="modal-overlay" (click)="toggleAddForm()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3 class="modal-title">Add New Ingredient</h3>
            <button class="close-btn" (click)="toggleAddForm()">
              ‚úï
            </button>
          </div>

          <div class="modal-body">
            <form [formGroup]="addItemForm" (ngSubmit)="addItem()">
              <div class="form-grid">
                <div class="input-group full-width">
                  <label class="input-label">Ingredient Name *</label>
                  <input
                    type="text"
                    formControlName="ingredientName"
                    class="input-field"
                    placeholder="e.g., Tomatoes"
                  />
                </div>

                <div class="input-group">
                  <label class="input-label">Category *</label>
                  <select formControlName="category" class="input-field">
                    <option value="">Select category</option>
                    @for (cat of categories; track cat.value) {
                      <option [value]="cat.value">{{ cat.emoji }} {{ cat.label }}</option>
                    }
                  </select>
                </div>

                <div class="input-group">
                  <label class="input-label">Amount *</label>
                  <input
                    type="text"
                    formControlName="amount"
                    class="input-field"
                    placeholder="e.g., 5"
                  />
                </div>

                <div class="input-group">
                  <label class="input-label">Unit</label>
                  <input
                    type="text"
                    formControlName="unit"
                    class="input-field"
                    placeholder="e.g., kg, pcs"
                  />
                </div>

                <div class="input-group">
                  <label class="input-label">Expiration Date</label>
                  <input
                    type="date"
                    formControlName="expirationDate"
                    class="input-field"
                  />
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-ghost" (click)="toggleAddForm()">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="addItemForm.invalid">
                  <span>Add to Pantry</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    }

    <!-- Loading State -->
    @if (isLoading) {
      <div class="loading-state">
        <div class="spinner-large"></div>
        <p>Loading your pantry...</p>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading && pantryItems.length === 0) {
      <div class="empty-state">
        <div class="empty-icon">ü•ï</div>
        <h3>Your pantry is empty</h3>
        <p>Start adding ingredients to discover amazing recipes!</p>
        <button class="btn btn-primary" (click)="toggleAddForm()">
          <span>Add Your First Ingredient</span>
        </button>
      </div>
    }

    <!-- Pantry Items by Category -->
    @if (!isLoading && pantryItems.length > 0) {
      <div class="pantry-grid">
        @for (item of pantryItems; track item.id) {
          <div class="pantry-item">
            <div class="item-header">
              <div class="item-icon">{{ getCategoryEmoji(item.category) }}</div>
              <div class="item-actions">
                <button class="action-btn delete" (click)="deleteItem(item.id)">
                  üóëÔ∏è
                </button>
              </div>
            </div>

            <div class="item-content">
              <h4 class="item-name">{{ item.ingredientName }}</h4>
              <span class="item-category">{{ item.category }}</span>
              <div class="item-amount">
                {{ item.amount }}
                @if (item.unit) {
                  <span>{{ item.unit }}</span>
                }
              </div>

              @if (item.expirationDate || item.addedDate) {
                <div class="item-meta">
                  @if (item.addedDate) {
                    <div class="meta-row">
                      <span class="meta-label">Added:</span>
                      <span class="meta-value">{{ item.addedDate | date:'shortDate' }}</span>
                    </div>
                  }
                  @if (item.expirationDate) {
                    <div class="meta-row">
                      <span class="meta-label">Expires:</span>
                      <span class="meta-value">{{ item.expirationDate | date:'shortDate' }}</span>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        }
      </div>
    }

    <!-- Suggested Recipes -->
    @if (suggestedRecipes.length > 0) {
      <div class="suggested-recipes" style="margin-top: 3rem;">
        <h2 class="section-title" style="font-size: 1.75rem; font-weight: 800; margin-bottom: 1.5rem;">
          <span>‚ú® Recipes You Can Make</span>
        </h2>

        <div class="recipes-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
          @for (recipe of suggestedRecipes; track recipe.id) {
            <app-recipe-card [recipe]="recipe"></app-recipe-card>
          }
        </div>
      </div>
    }
  </div>
</div>
